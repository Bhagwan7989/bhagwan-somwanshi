package servlet;

import dao.TransactionDAO;
import model.Transaction;
import javax.servlet.*;
import javax.servlet.http.*;
import java.io.IOException;
import java.text.SimpleDateFormat;
import java.util.*;

public class ReportServlet extends HttpServlet {
    protected void doPost(HttpServletRequest req, HttpServletResponse res) throws ServletException, IOException {
        try {
            String from = req.getParameter("fromDate");
            String to = req.getParameter("toDate");
            String min = req.getParameter("minAmount");
            String max = req.getParameter("maxAmount");

            if (from == null || to == null || from.isEmpty() || to.isEmpty()) {
                req.setAttribute("error", "⚠️ Date field is mandatory!");
                req.getRequestDispatcher("index.jsp").forward(req, res);
                return;
            }

            double minAmt = (min == null || min.isEmpty()) ? 0 : Double.parseDouble(min);
            double maxAmt = (max == null || max.isEmpty()) ? Double.MAX_VALUE : Double.parseDouble(max);

            SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");
            Date fromDate = sdf.parse(from);
            Date toDate = sdf.parse(to);

            List<Transaction> list = new TransactionDAO().getTransactions(fromDate, toDate, minAmt, maxAmt);
            req.setAttribute("transactions", list);

        } catch (Exception e) {
            e.printStackTrace();
            req.setAttribute("error", "Something went wrong!");
        }
        req.getRequestDispatcher("index.jsp").forward(req, res);
    }
}
