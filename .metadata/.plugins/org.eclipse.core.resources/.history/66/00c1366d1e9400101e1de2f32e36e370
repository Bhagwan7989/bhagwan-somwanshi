<%@ page import="java.util.*, model.Transaction" %>
<%@ page contentType="text/html;charset=UTF-8" %>

<html>
<head>
    <title>Transaction Report</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f1f5f9; padding: 20px; }
        h2 { color: #1e293b; text-align: center; animation: fadeIn 1s ease; }
        .filter-form {
            background: #fff; padding: 15px; border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1); margin: 20px auto;
            max-width: 700px; animation: slideIn 0.8s ease;
        }
        .filter-row { margin-bottom: 15px; }
        .filter-row label { display: block; font-weight: bold; color: #334155; margin-bottom: 5px; }
        .filter-row input, .filter-row select {
            width: 100%; padding: 8px; border: 1px solid #cbd5e1;
            border-radius: 6px; transition: all 0.3s ease;
        }
        .filter-row input:focus, .filter-row select:focus {
            border-color: #3b82f6; box-shadow: 0 0 5px #93c5fd;
        }
        button, a {
            display: inline-block; padding: 8px 15px; border: none;
            border-radius: 6px; cursor: pointer; font-weight: bold;
            color: white; background: #3b82f6; text-decoration: none;
            transition: transform 0.2s ease, background 0.3s ease;
        }
        button:hover, a:hover { transform: scale(1.05); background: #2563eb; }
        a.export { background: #10b981; }
        a.export:hover { background: #059669; }
        table {
            border-collapse: collapse; width: 100%; background: white;
            border-radius: 10px; overflow: hidden; margin-top: 20px;
            animation: fadeIn 1s ease;
        }
        th, td { padding: 10px; border: 1px solid #e2e8f0; text-align: left; }
        th { background: #3b82f6; color: white; position: sticky; top: 0; }
        tr:nth-child(even) { background: #f9fafb; }
        .pagination { margin-top: 20px; text-align: center; }
        .pagination button { margin: 5px; }
        .error { color: red; text-align: center; font-weight: bold; }
        @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
        @keyframes slideIn { from {transform: translateY(-20px); opacity:0;} to {transform: translateY(0); opacity:1;} }
    </style>
</head>
<body>
<h2>Transaction Report</h2>

<form method="post" action="ReportServlet" class="filter-form">
    <div class="filter-row">
        <label>Account Number:</label>
        <input type="text" name="accountNumber" value="<%= request.getAttribute("accountNumber")!=null ? request.getAttribute("accountNumber") : "" %>"/>
    </div>
    <div class="filter-row">
        <label>IFSC Code:</label>
        <input type="text" name="ifscCode" value="<%= request.getAttribute("ifscCode")!=null ? request.getAttribute("ifscCode") : "" %>"/>
    </div>
    <div class="filter-row">
        <label>Status:</label>
        <select name="status">
            <option value="">All</option>
            <option value="SUCCESS" <%= "SUCCESS".equals(request.getAttribute("status")) ? "selected" : "" %>>SUCCESS</option>
            <option value="FAILED" <%= "FAILED".equals(request.getAttribute("status")) ? "selected" : "" %>>FAILED</option>
        </select>
    </div>
    <div class="filter-row">
        <label>Date From:</label>
        <input type="date" name="dateFrom" value="<%= request.getAttribute("dateFrom")!=null ? request.getAttribute("dateFrom") : "" %>"/>
    </div>
    <div class="filter-row">
        <label>Date To:</label>
        <input type="date" name="dateTo" value="<%= request.getAttribute("dateTo")!=null ? request.getAttribute("dateTo") : "" %>"/>
    </div>
    <div class="filter-row">
        <label>Amount From:</label>
        <input type="number" step="0.01" name="amountFrom" value="<%= request.getAttribute("amountFrom")!=null ? request.getAttribute("amountFrom") : "" %>"/>
    </div>
    <div class="filter-row">
        <label>Amount To:</label>
        <input type="number" step="0.01" name="amountTo" value="<%= request.getAttribute("amountTo")!=null ? request.getAttribute("amountTo") : "" %>"/>
    </div>
    <div class="filter-row" style="text-align:center;">
        <button type="submit">Show Report</button>
        <a class="export" href="ExcelExportServlet">Export Excel</a>
        <a class="export" href="PdfExportServlet">Export PDF</a>
    </div>
</form>

<%
    if(request.getAttribute("error") != null) {
%>
<p class="error"><%= request.getAttribute("error") %></p>
<%
    }
    List<Transaction> transactions = (List<Transaction>) request.getAttribute("transactions");
    if(transactions != null && !transactions.isEmpty()) {
%>
<table>
    <tr>
        <th>ID</th><th>Account</th><th>IFSC</th><th>Beneficiary</th><th>Sender</th>
        <th>Date</th><th>Amount</th><th>Currency</th><th>Mode</th><th>Status</th>
        <th>Reference</th><th>UTR</th><th>Branch</th><th>Description</th><th>Remarks</th>
    </tr>
    <%
        for(Transaction t : transactions){
    %>
    <tr>
        <td><%=t.getTransactionId()%></td>
        <td><%=t.getAccountNumber()%></td>
        <td><%=t.getIfscCode()%></td>
        <td><%=t.getBeneficiaryName()%></td>
        <td><%=t.getSenderName()%></td>
        <td><%=t.getTransactionDate()%></td>
        <td><%=t.getAmount()%></td>
        <td><%=t.getCurrency()%></td>
        <td><%=t.getMode()%></td>
        <td><%=t.getStatus()%></td>
        <td><%=t.getReferenceNumber()%></td>
        <td><%=t.getUtrNumber()%></td>
        <td><%=t.getBranch()%></td>
        <td><%=t.getDescription()%></td>
        <td><%=t.getRemarks()%></td>
    </tr>
    <% } %>
</table>
<div class="pagination">
    <form method="post" action="ReportServlet" style="display:inline;">
        <input type="hidden" name="page" value="<%= (Integer)request.getAttribute("page")-1 %>"/>
        <button type="submit" <%= ((Integer)request.getAttribute("page")<=1) ? "disabled" : "" %>>Previous</button>
    </form>
    <span>Page <%= request.getAttribute("page") %></span>
    <form method="post" action="ReportServlet" style="display:inline;">
        <input type="hidden" name="page" value="<%= (Integer)request.getAttribute("page")+1 %>"/>
        <button type="submit">Next</button>
    </form>
</div>
<%
    } else if(transactions != null){
%>
<p class="error">No records found.</p>
<%
    }
%>
</body>
</html>
